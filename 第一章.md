#### 写在前面
  计算机系统是由硬件和系统软件组成的，它们共同工作来运行应用程序。
  
```C
    #include<studio.h>
    
    int main()
    {
       printf("hello,world\n");
       return 0;
    }
```
这种代码几乎是每一个学习编程的都写过的，本书将沿着这段程序的生命周期，简要的介绍一些逐步出现的关键概念、专业术语和组成部分。

#### 1.1 信息就是位+上下文
hello程序的生命周期是从一个源程序开始的，即我们通过编辑器创建的文本文件，hello.c文件（由值0，1组成的位（比特序列）序列，8个位被组成一组，成为字节）。
现代计算机基本都使用ASCII标准来表示文本字符，实质上就是用唯一的单字节大小的整数值来表示每个字符。hello.c这种只由ASCII字符组成文件成为文本文件，其余文件成为二进制文件。
#### 1.2 程序被其他程序翻译成不同的格式
hello程序起初是一个高级C语言程序，但是为了在系统上运行hello.c程序，我们需要把它转化成低级机器语言指令，一系列打包操作形成可执行目标文件。

在Unix操作系统上，源文件到目标文件的转化由编译器驱动程序完成：
```Linux
  linux> gcc -o hello hello.c
```
GCC编译驱动程序将hello.c翻译成一个可执行目标文件hello。共分为四个阶段：
![image](https://github.com/sunhaofeng2001/-/blob/master/IMG/%E6%89%B9%E6%B3%A8%202020-08-03%20204128.png)
#### 1.3 了解编译系统工作是大有益处的
  *优化程序性能

  *理解链接时出现的问题

  *避免安全漏洞
  
#### 1.4 处理器读并理解储存在内存中的指令
在Linux的shell中运行可执行目标文件
```Unix
linux> ./hello
hello,world
```
#### 1.4.1 系统的硬件组成
##### 1.总线
    贯穿整个系统的是一组电子管道，称作总线，它携带信息字节并负责在各个部件间传
    递。通常总线被设计成传送定长的字节块，也就是字（word)。
##### 2.I/O设备
    I/〇(输入/输出）设备是系统与外部世界的联系通道。每个 I/O 设备都通过一个控制器或适配器与 I/O 总线相连。
##### 3.主存
    主存是一个临时存储设备，在处理器执行程序时，用来存放程序和程序处理的数据。从
    物理上来说，主存是由一组动态随机存取存储器(DRAM)芯片组成的。从逻辑上来说，存储
    器是一个线性的字节数组，每个字节都有其唯一的地址（数组索引）， 这些地址是从零开始
    的。
##### 4.处理器
    中央处理单元（CPU), 简称处理器，是解释（或执行）存储在主存中指令的引擎。处理
    器的核心是一个大小为一个字的存储设备（或寄存器）， 称为程序计数器（PC)。在任何时
    刻，PC 都指向主存中的某条机器语言指令（即含有该条指令的地址）。
    *加载  从主存复制一个字节或者一个字到寄存器，以覆盖寄存器原来的内容。
    
    *储存  从寄存器复制一个字节或者一个字到主存的某个位置，以覆盖这个位置上原
    来的内容。

    *操作  把两个寄存器的内容复制到 ALU, ALU 对这两个字做算术运算，并将结果
    存放到一个寄存器中，以覆盖该寄存器中原来的内容
    
    *转跳  从指令本身中抽取一个字，并将这个字复制到程序计数器（PC)中，以覆盖
    PC 中原来的值。
    
    指令集架构描述的是每条机器代码指令的效果；而微体系结构描述的是处理器实际
    上是如何实现的。

#### 1.4.2 运行hello程序
初始时，shell 程序执行它的指令，等待我们输人一个命令。当我们在键盘上输人字符串
./hello后，shell 程序将字符逐一读人寄存器，再把它存放到内存中。

![image](https://github.com/sunhaofeng2001/-/blob/master/IMG/%E6%89%B9%E6%B3%A8%202020-08-03%20210610.png)

在键盘上敲回车键时，shell 程序就知道我们已经结束了命令的输人。然后
shell 执行一系列指令来加载可执行的 hello 文件，这些指令将 hello 目标文件中的代码
和数据从磁盘复制到主存。数据包括最终会被输出的字符串 hello,world

#### 1.5 高速缓存至关重要
高速缓存存储器（cache memory, 简称为 cache 或高速缓存）， 作为暂时的集结区域，存放处
理器近期可能会需要的信息。位于处理器芯片上的 L1 高速缓存的容量可以达到数万字节，访问速度几乎和访问寄存器文件一样
快。一个容量为数十万到数百万字节的更大的 L2 高速缓存通过一条特殊的总线连接到处
理器。进程访问 L2 高速缓存的时间要比访问 L1 高速缓存的时间长 5 倍，但是这仍然比访
问主存的时间快 5 10 倍。L1 和 L2 高速缓存是用一种叫做静态随机访问存储器（SRAM)
的硬件技术实现的。系统可以获得一个很大的存储器，同时访问速度也很快，原因是利用了高速缓存的局
部性原理，即程序具有访问局部区域里的数据和代码的趋势。通过让高速缓存里存放可能
经常访问的数据，大部分的内存操作都能在快速的高速缓存中完成。
![image](https://github.com/sunhaofeng2001/-/blob/master/IMG/%E6%89%B9%E6%B3%A8%202020-08-03%20211307.png)
###### 意识到高速缓存存储器存在的应用程序员能够利用高速缓存将程序的性能提高一个数量级。

#### 1.6 存储设备形成层次结构
在处理器和一个较大较慢的设备（例如主存）之间插入一个更小更快的存储设备（例如
高速缓存）的想法已经成为一个普遍的观念。
在这个层次结构中，从上至下，设备的访
问速度越来越慢、容量越来越大，并且每字节的造价也越来越便宜。寄存器文件在层次结
构中位于最顶部，也就是第0级或记为 L0 这里我们展示的是三层高速缓存 L1 到 L3,
占据存储器层次结构的第 1 层到第 3 层。主存在第 4 层，以此类推。
![image](https://github.com/sunhaofeng2001/-/blob/master/IMG/%E6%89%B9%E6%B3%A8%202020-08-03%20211632.png)

#### 1.7 操作系统管理硬件
当 shell 加载和运行 hello 程序时，以及 hello 程序输
出自己的消息时，shell 和 hello 程序都没有直接访问键盘、显示器、磁盘或者主存。取而
代之的是，它们依靠操作系统提供的服务。我们可以把操作系统看成是应用程序和硬件之间
插人的一层软件，所有应用程序对硬件的操作尝试都必须通过操作系统。

操作系统有两个基本功能：
（1)防止硬件被失控的应用程序滥用；
（2)向应用程序提供简单一致的机制来控制复杂而又通常大
不相同的低级硬件设备。

#### 1.7.1 进程
进程是操作系统对一个正在运行的程序的一种抽象。在一个系统上可以同时运行多个
进程，而每个进程都好像在独占地使用硬件。而并发运行，则是说一个进程的指令和另一
个进程的指令是交错执行的。一个 CPU 看上去都像是在并发地执行多个
进程，这是通过处理器在进程间切换来实现的。操作系统实现这种交错执行的机制称为上
下文切换。

操作系统保持跟踪进程运行所需的所有状态信息。这种状态，也就是上下文，包括许
多信息，比如 PC 和寄存器文件的当前值，以及主存的内容。在任何一个时刻，单处理器
系统都只能执行一个进程的代码。当操作系统决定要把控制权从当前进程转移到某个新进
程时，就会进行上下文切换，即保存当前进程的上下文、恢复新进程的上下文，然后将控
制权传递到新进程。新进程就会从它上次停止的地方开始。


![image](https://github.com/sunhaofeng2001/-/blob/master/IMG/%E6%89%B9%E6%B3%A8%202020-08-03%20212255.png)

#### 1.7.2 线程
一个进程实际上可以由多个称为线程的执行单元组成，每个线程都运行在进程的上下文中，并共享同样的
代码和全局数据。 

多线程之间比多进程之间更容易共享数据，也因为线程一般来说都比进程更高
效。当有多处理器可用的时候，多线程也是一种使得程序可以运行得更快的方法。

#### 1.7.3 虚拟内存
虚拟内存是一个抽象概念，它为每个进程提供了一个假象，即每个进程都在独占地使用
主存。每个进程看到的内存都是一致的，称为虚拟地址空间。

![image](https://github.com/sunhaofeng2001/-/blob/master/IMG/%E6%89%B9%E6%B3%A8%202020-08-03%20213143.png)


    *程序代码和数据。 
     对所有的进程来说，代码是从同一固定地址开始，紧接着的是和 C全局变量相对应的数据位置。
     代码和数据区是直接按照可执行目标文件的内容初始化的，在示例中就是可执行文件 hello。
    *堆。
    代码和数据区后紧随着的是运行时堆。代码和数据区在进程一开始运行时就被
    指定了大小，与此不同，当调用像 malloc 和 free 这样的 C 标准库函数时，堆可
    以在运行时动态地扩展和收缩。
    *共享库。
    大约在地址空间的中间部分是一块用来存放像 C 标准库和数学库这样的共
    享库的代码和数据的区域。共享库的概念非常强大，也相当难懂。
    *栈。
    位于用户虚拟地址空间顶部的是用户栈，编译器用它来实现函数调用。和堆一
    样，用户栈在程序执行期间可以动态地扩展和收缩。特别地，每次我们调用一个函
    数时，栈就会增长；从一个函数返回时，栈就会收缩。
    *内核虚拟内存。
    地址空间顶部的区域是为内核保留的。不允许应用程序读写这个区
    域的内容或者直接调用内核代码定义的函数。相反，它们必须调用内核来执行这些
    操作。
    
虚拟内存的运作需要硬件和操作系统软件之间精密复杂的交互，包括对处理器生成的每
个地址的硬件翻译。基本思想是把一个进程虚拟内存的内容存储在磁盘上，然后用主存作为
磁盘的高速缓存。

#### 1.7.4 文件
文件就是字节序列，仅此而已。每个 I/O 设备，包括磁盘、键盘、显示器，甚至网
络，都可以看成是文件。

#### 1.8 系统之间利用网络通信
文件就是字节序列，仅此而已。每个 I/O 设备，包括磁盘、键盘、显示器，甚至网
络，都可以看成是文件。实际上，现代系统经常通过网络和其他系统连接到一起。从一个单独的系统来看，网络可视为一个
I/O 设备。。当系统从主存复制一串字节到网络适配器时，数据流经过网络
到达另一台机器，而不是比如说到达本地磁盘驱动器。相似地，系统可以读取从其他机器
发送来的数据，并把数据复制到自己的主存。随着 Internet 这样的全球网络的出现，从一台主机复制信息到另外一台主机已经成为计算机系统最重要的用途之一。
![image](https://github.com/sunhaofeng2001/-/blob/master/IMG/%E6%89%B9%E6%B3%A8%202020-08-03%20214750.png)
#### 1.9.1 Amdahl定律
当我们对系统的某个部分加速时，其对系统整体性能的影响取决于该部分的重要
性和加速程度。
![image](https://github.com/sunhaofeng2001/-/blob/master/IMG/%E6%89%B9%E6%B3%A8%202020-08-03%20215205.png)
#### 1.9.2 并发与并行
数字计算机的整个历史中，有两个需求是驱动进步的持续动力：一个是我们想要计算
机做得更多，另一个是我们想要计算机运行得更快。我们用的术语并发(concurrency)是一个通用的概念，指一个同时具
有多个活动的系统；而术语并行（parallelism)指的是用并发来使一个系统运行得更快。

      1. 线程级并发   
      使用线程，我们甚至能够在一个进程中执行多个控制流。
      多核处理器是将多个 CPU(称为“核”)集成到一个集成电路芯片上。
      超线程，有时称为同时多线程（simultaneous multi-threading), 是一项允许一个 CPU
      执行多个控制流的技术。
      2. 指令级并行   
      在较低的抽象层次上，现代处理器可以同时执行多条指令的属性称为指令级并行。
      3. 单指令、多数据并行  
      在最低层次上，许多现代处理器拥有特殊的硬件，允许一条指令产生多个可以并行执
      行的操作，这种方式称为单指令、多数据，即 SIMD 并行。
      
#### 1.9.3 计算机系统中抽象的重要性
 抽象的使用是计算机科学中最为重要的概念之一。在处理器里，指令
集架构提供了对实际处理器硬件的抽象。使用这个抽象，机器代码程序表现得就好像运行
在一个一次只执行一条指令的处理器上。底层的硬件远比抽象描述的要复杂精细，它并行
地执行多条指令，但又总是与那个简单有序的模型保持一致。只要执行模型一样，不同的
处理器实现也能执行同样的机器代码，而又提供不同的开销和性能。
![image](https://github.com/sunhaofeng2001/-/blob/master/IMG/%E6%89%B9%E6%B3%A8%202020-08-03%20220332.png)
文件是对 I/O 设备的抽象，虚拟内存是对程序存储器的抽象，而进程是对一个正在运行的程序的抽象。
虚拟机，它提供对整个计算机的抽象，包括操作系统、处理器和程序。
#### 1.10 小结
计算机系统是由硬件和系统软件组成的，它们共同协作以运行应用程序。计算机内部的信息被表示
为一组组的位，它们依据上下文有不同的解释方式。程序被其他程序翻译成不同的形式，开始时是
ASCII 文本，然后被编译器和链接器翻译成二进制可执行文件。处理器读取并解释存放在主存里的二进制指令。因为计算机花费了大量的时间在内存、I/O 设备和CPU 寄存器之间复制数据，所以将系统中的存储设备划分成层次结构
层的硬件高速缓存存储器、DRAM 主存和磁盘存储器。在层次模型中，位于更高层的存储设备比低层的
存储设备要更快，单位比特造价也更高。层次结构中较高层次的存储设备可以作为较低层次设备的高速
缓存。通过理解和运用这种存储层次结构的知识，程序员可以优化 C 程序的性能。
操作系统内核是应用程序和硬件之间的媒介。它提供三个基本的抽象：1)文件是对 I/O 设备的抽象；
2)虚拟内存是对主存和磁盘的抽象；3)进程是处理器、主存和 I/O 设备的抽象。
最后，网络提供了计算机系统之间通信的手段。从特殊系统的角度来看，网络就是一种 I/O 设备。
